CREATE USER TODO_APP IDENTIFIED BY Todo123;
GRANT CONNECT, RESOURCE TO TODO_APP;

CREATE TABLE TODO_APP.TAREFA (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITULO VARCHAR2(200) NOT NULL,
    DESCRICAO CLOB,
    STATUS VARCHAR2(20) DEFAULT 'PENDENTE' NOT NULL,
    DATA_LIMITE DATE,
    CATEGORIA VARCHAR2(100),
    CRIADO_EM TIMESTAMP DEFAULT SYSTIMESTAMP,
);

CREATE TABLE TODO_APP.TAREFA_HISTORICO (
    ID NUMBER GENERAATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITULO VARCHAR2(200),
    DESCRICAO VARCHAR2 CLOB,
    STATUS VARCHAR2(20),
    DATA_LIMITE DATE,
    CATEGORIA VARCHAR2(100),
    CRIADO_EM TIMESTAMP,
);

CREATE OR REPLACE PROCEDURE TODO_APP.VALIDAR_TAREFA(p_data_limite IN DATE) IS
BEGIN
    IF p_data_limite IS NOT NULL AND p_data_limite < TRUNC(SYSDATE) THEN
        RAISE_APPLICATION_ERROR(-20001, 'Data limite nÃ£o pode ser no passado.');
    END IF;
END VALIDAR_TAREFA;
/

CREATE OR REPLACE PROCEDURE TODO_APP.MOVER_TAREFA_CONCLUIDA(p_tarefa_id IN NUMBER) IS
BEGIN
    INSERT INTO TODO_APP.TAREFA_HISTORICO (ID, TITULO, DESCRICAO, STATUS, DATA_LIMITE, CATEGORIA, CRIADO_EM)
    SELECT ID, TITULO, DESCRICAO, STATUS, DATA_LIMITE, CAREGORIA, CRIADO_EM FROM TODO_APP.TAREFA WHERE ID = p_tarefa_id;

    DELETE FROM TODO_APP.TAREFA WHERE ID = p_tarefa_id;
    COMMIT;
END MOVER_TAREFA_CONCLUIDA;

